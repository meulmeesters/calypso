var calypso;!function(e){var t;!function(e){var t;!function(e){e.DEFAULT_ACCEPT_HEADER="application/vnd.iuclid6.ext+json",e.DEFINITION_ACCEPT_HEADER="application/vnd.iuclid6.ext+json;type=iuclid6.Definition",e.BASE_URL="http://iuclid.ca:3000",e.BASE_URI=e.BASE_URL+"/iuclid6-ext/api/ext/v1",e.BASE_DEFINITIONS_URI=e.BASE_URI+"/definition",e.SUBMISSION_TYPES_URI=e.BASE_DEFINITIONS_URI+"/submissiontypes",e.DOCUMENT_TREE_URI=e.BASE_DEFINITIONS_URI+"/tree",e.SUBSTANCE_URI=e.BASE_URI,e.END_POINT_STUDY_URI=e.BASE_URI+"/endpointstudy"}(t=e.API||(e.API={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.addFilter="filter.add",e.afterAddFilter="filter.add.after",e.removeFilter="filter.remove",e.afterRemoveFilter="filter.remove.after",e.applyFilters="filter.apply",e.afterApplyFilters="filter.apply.after",e.loadIuclidEndPointStudies="iuclidEndPointStudy.load",e.loadIuclidSubstances="iuclidSubstance.load",e.performSearch="search.load",e.loadSubmissionType="submission-type.load",e.loadDocument="document.load"}(t=e.Events||(e.Events={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.Sort={ASC:"fieldAscending",DESC:"fieldDescending"},e.ORGANIZATION={title:"Organization",type:"checkbox",category:"ORGANIZATION",options:[{category:"ORGANIZATION",key:"OECD",label:"OECD",value:!1,submitValue:"OECD",multi:!1},{category:"ORGANIZATION",key:"HC",label:"Health Canada",value:!1,submitValue:"HC",multi:!1},{category:"ORGANIZATION",key:"EC",label:"Environment Canada and Climate Change",value:!1,submitValue:"EC",multi:!1}]},e.IUCLID_SUBSTANCE_FILTERS=[e.ORGANIZATION]}(t=e.Filters||(e.Filters={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.FAVORITE_IUCLID_END_POINT_STUDIES="calypso.iuclidEndPointStudies.favorites",e.FAVORITE_IUCLID_SUBSTANCES="calypso.iuclidSubstances.favorites"}(t=e.LocalStorage||(e.LocalStorage={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.DEFAULT_LIMIT=12}(t=e.Paging||(e.Paging={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){var t="/templates/";e.SUBSTANCES_TPL=t+"substances.html",e.NEW_SUBSTANCE_TPL=t+"new-substance.html",e.ENDPOINTSTUDIES_TPL=t+"endpointstudies.html",e.HOME_TPL=t+"home.html",e.NOT_FOUND_TPL=t+"not-found.html",e.GENERIC_FORM_TPL=t+"directives/generic-form.html",e.SEARCH_BAR_TPL=t+"directives/search-bar.html",e.SIDE_FILTER_TPL=t+"directives/side-filter.html",e.SIDE_TREE_TPL=t+"directives/side-tree/side-tree.html",e.SIDE_TREE_SECTION_TPL=t+"directives/side-tree/side-tree-section.html",e.IUCLID_SUBSTANCE_FILTER_TPL=t+"directives/iuclid-substance-filter.html",e.IUCLID_SUBSTANCE_LIST_TPL=t+"directives/iuclid-substance-list.html",e.IUCLID_END_POINT_STUDY_FILTER_TPL=t+"directives/iuclid-end-point-study-filter.html",e.IUCLID_END_POINT_STUDY_LIST_TPL=t+"directives/iuclid-end-point-study-list.html",e.BREADCRUMB_TPL=t+"directives/breadcrumbs.html",e.PAGING_TPL=t+"directives/paging.html",e.IUCLID_FORM_TPL=t+"directives/iuclid-form/iuclid-form.html",e.IUCLID_FORM_TOOLBAR_TPL=t+"directives/iuclid-form/form-toolbar.html",e.IUCLID_FORM_CONTENTS_TPL=t+"directives/iuclid-form/iuclid-form-contents.html",e.IUCLID_FORM_PICKER_TPL=t+"directives/iuclid-form/iuclid-form-picker.html",e.IUCLID_ATTRIBUTE_BLOCK_TPL=t+"directives/iuclid-attributes/iuclid-block.html",e.IUCLID_ATTRIBUTE_CHECKBOX_TPL=t+"directives/iuclid-attributes/iuclid-checkbox.html",e.IUCLID_ATTRIBUTE_TEXT_TPL=t+"directives/iuclid-attributes/iuclid-text.html",e.IUCLID_ATTRIBUTE_PICK_LIST_TPL=t+"directives/iuclid-attributes/iuclid-pick-list.html",e.IUCLID_ATTRIBUTE_ATTACHMENT_TPL=t+"directives/iuclid-attributes/iuclid-attachment.html",e.IUCLID_ATTRIBUTE_RANGE_TPL=t+"directives/iuclid-attributes/iuclid-range.html",e.IUCLID_ATTRIBUTE_NUMERIC_TPL=t+"directives/iuclid-attributes/iuclid-numeric.html",e.IUCLID_ATTRIBUTE_DATE_TPL=t+"directives/iuclid-attributes/iuclid-date.html",e.NGX_DROP_DOWN_TPL=t+"directives/ngx/drop-down.html"}(t=e.Templates||(e.Templates={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t=e.Const.Templates;angular.module("calypso.services",[]),angular.module("calypso.directives",[]),angular.module("calypso",["ngRoute","calypso.services","calypso.directives"]),angular.module("calypso").constant("_",_),angular.module("calypso").config(["$routeProvider","$compileProvider",function(e,i){i.debugInfoEnabled(!1),e.when("/",{redirectTo:"/substances"}).when("/substances",{templateUrl:t.SUBSTANCES_TPL}).when("/substances/new",{templateUrl:t.NEW_SUBSTANCE_TPL}).when("/endpointstudies",{templateUrl:t.ENDPOINTSTUDIES_TPL}).otherwise({templateUrl:t.NOT_FOUND_TPL})}]),angular.module("calypso").run(["AppConfig",function(e){e.loadSubmissionTypes("SUBSTANCE")}])}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("calypso.directives").directive("iuclidSubstanceFilter",["_","DB","EventBus",function(t,n,s){return{restrict:"E",scope:{filter:"="},templateUrl:i.IUCLID_SUBSTANCE_FILTER_TPL,link:function(t){t.onChange=function(t,i){switch(i.type){case"checkbox":var n=t.value===!0?e.Const.Events.addFilter:e.Const.Events.removeFilter;t.multi===!1&&i.options.forEach(function(i){i.key!==t.key&&i.value===!0&&(i.skipApply=!0,i.value=!1,s.publish(e.Const.Events.removeFilter,i))}),s.publish(n,t)}}}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("calypso.directives").directive("iuclidEndPointStudyList",["$window","DB","EventBus",function(t,n,s){return{restrict:"E",scope:{},templateUrl:i.IUCLID_END_POINT_STUDY_LIST_TPL,link:function(i,c){i.iuclidEndPointStudies=n.getIuclidEndPointStudies(),i.openIuclidEndPointStudy=function(e){e&&e.clickUri&&t.open(e.clickUri)},i.favoriteIuclidEndPointStudy=function(i,n){n.preventDefault(),n.stopPropagation();var s=e.Const.LocalStorage.FAVORITE_IUCLID_END_POINT_STUDIES,c=t.localStorage.getItem(s),o=c?JSON.parse(c):{};i._favorite===!0?(i._favorite=!1,delete o[i.key]):(i._favorite=!0,o[i.key]=!0),t.localStorage.setItem(s,JSON.stringify(o))},s.subscribe(e.Const.Events.loadIuclidEndPointStudies,i,function(){document.querySelector("div.iuclid-end-point-study-list").scrollTop=0})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("calypso.directives").directive("iuclidSubstanceList",["$window","DB","EventBus",function(t,n,s){return{restrict:"E",scope:{},templateUrl:i.IUCLID_SUBSTANCE_LIST_TPL,link:function(i,c){i.iuclidSubstances=n.getIuclidSubstances(),i.openIuclidSubstance=function(e){e&&e.clickUri&&t.open(e.clickUri)},i.favoriteIuclidSubstance=function(i,n){n.preventDefault(),n.stopPropagation();var s=e.Const.LocalStorage.FAVORITE_IUCLID_SUBSTANCES,c=t.localStorage.getItem(s),o=c?JSON.parse(c):{};i._favorite===!0?(i._favorite=!1,delete o[i.key]):(i._favorite=!0,o[i.key]=!0),t.localStorage.setItem(s,JSON.stringify(o))},s.subscribe(e.Const.Events.loadIuclidSubstances,i,function(){document.querySelector("div.iuclid-substance-list").scrollTop=0})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Templates,n=e.Const.Events;angular.module("calypso.directives").directive("searchBar",["DB","EventBus",function(e,t){return{restrict:"E",replace:!0,scope:{},templateUrl:i.SEARCH_BAR_TPL,link:function(i){i.data={submissionTypes:[]},i.data.submissionTypes=e.getSubmissionTypes(),i.onSubmissionTypeSelect=function(i){e.setSubmissionType(i),t.publish(n.loadSubmissionType,i)}}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("calypso.directives").directive("sideFilter",[function(){return{restrict:"E",scope:{filters:"="},templateUrl:i.SIDE_FILTER_TPL,link:function(t){console.log("FILTERS:"+t.filters),t.filters=e.Const.Filters.IUCLID_SUBSTANCE_FILTERS}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=e.Const.API,s=function(){function e(e,t){this.$http=e,this.DB=t,i=this}return e.prototype.loadSubmissionTypes=function(e){i.$http.get(n.SUBMISSION_TYPES_URI,{headers:{Accept:n.DEFINITION_ACCEPT_HEADER},params:{for:e}}).then(function(e){i.DB.setSubmissionTypes(e.data)}).catch(function(e){console.error("Failed to load Submission Types: "+JSON.stringify(e))})},e}();s.$inject=["$http","DB"],t.AppConfig=s,angular.module("calypso.services").service("AppConfig",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=function(){function t(t,n,s){this.$parse=t,this._=n,this.EventBus=s,i=this,i._db={filters:{},iuclidSubstances:[],submissionTypes:[],submissionType:null,sort:{field:"tpmillesime",dir:e.Const.Filters.Sort.DESC},paging:{offset:0,limit:e.Const.Paging.DEFAULT_LIMIT}},s.subscribe(e.Const.Events.addFilter,i,i.addFilter),s.subscribe(e.Const.Events.removeFilter,i,i.removeFilter),s.subscribe(e.Const.Events.loadIuclidSubstances,i,i.loadIuclidSubstances)}return t.prototype.addFilter=function(t){t&&(t.multi?(i._db.filters[t.category]=i._db.filters[t.category]||[],i._db.filters[t.category].push(t)):i._db.filters[t.category]=t,i.EventBus.publish(e.Const.Events.afterAddFilter,t),i.EventBus.publish(e.Const.Events.applyFilters))},t.prototype.removeFilter=function(t){var n=i._db.filters;if(n&&n[t.category]){if(t.multi){var s=n[t.category];s.splice(_.findIndex(s,{key:t.key}),1),0===s.length&&delete n[t.category]}else delete n[t.category];i.EventBus.publish(e.Const.Events.afterRemoveFilter,t),t.skipApply!==!0&&i.EventBus.publish(e.Const.Events.applyFilters)}var c=i._.findIndex(e.Const.Filters.IUCLID_SUBSTANCE_FILTERS,{category:t.category}),o=e.Const.Filters.IUCLID_SUBSTANCE_FILTERS[c];if(o)if(t.multi){if(c=i._.findIndex(o.options,{key:t.key}),o.options[c])switch(o.type){case"checkbox":o.options[c].value=!1}}else switch(o.type){case"checkbox":var a=i._.find(o.options,{key:t.key})||{};a.value=!1}},t.prototype.loadIuclidSubstances=function(e){var t=e.results,n=i.getIuclidSubstances();n.splice(0,n.length),n.push.apply(n,t)},t.prototype.loadIuclidEndPointStudies=function(e){var t=e.results,n=i.getIuclidEndPointStudies();n.splice(0,n.length),n.push.apply(n,t)},t.prototype.getFilters=function(){return i.$parse("_db.filters")(i)},t.prototype.getIuclidEndPointStudies=function(){return i.$parse("_db.iuclidEndPointStudies")(i)},t.prototype.getIuclidSubstances=function(){return i.$parse("_db.iuclidSubstances")(i)},t.prototype.getSorting=function(){return i.$parse("_db.sort")(i)},t.prototype.getPaging=function(){return i.$parse("_db.paging")(i)},t.prototype.setPaging=function(e){i._db.paging=e},t.prototype.setSubmissionTypes=function(e){var t=i.getSubmissionTypes();t.splice(0,t.length),t.push.apply(t,e)},t.prototype.getSubmissionTypes=function(){return i.$parse("_db.submissionTypes")(i)},t.prototype.setSubmissionType=function(e){i._db.submissionType=e},t.prototype.getSubmissionType=function(){return i.$parse("_db.submissionType")(i)},t}();n.$inject=["$parse","_","EventBus"],t.DB=n,angular.module("calypso.services").service("DB",n)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=e.Const.API,s=function(){function e(e,t,n){this.$q=e,this.$http=t,this.$timeout=n,this._cache={},i=this}return e.prototype.getDocumentDefinition=function(e){var t=i.$q.defer(),s=n.BASE_DEFINITIONS_URI+"/document/"+e;return i._cache[e]?i.$timeout(function(){t.resolve(i._cache[e])},50):i.$http.get(s,{params:{_c:(new Date).getTime()},headers:{Accept:n.DEFINITION_ACCEPT_HEADER}}).then(function(n){i._cache[e]=n.data,t.resolve(n.data)}).catch(function(e){alert("Failed to Get Document Definition: "+JSON.stringify(e))}),t.promise},e}();s.$inject=["$q","$http","$timeout"],t.DocumentService=s,angular.module("calypso.services").service("DocumentService",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t,i=function(){function e(){t=this,t._topics={},t._subUid=-1}return e.prototype.subscribe=function(e,i,n,s){t._topics[e]||(t._topics[e]=[]);var c=(++t._subUid).toString();return t._topics[e].push({token:c,handler:n,scope:i,priority:s||1e4}),c},e.prototype.publish=function(e,i){if(!t._topics[e])return!1;var n=t._topics[e],s=n?n.length:0;return s>0&&n.sort(function(e,t){return e.priority-t.priority}).forEach(function(e){angular.isFunction(e.handler)&&e.handler.call(e.scope,i)}),!0},e.prototype.unsubscribe=function(e){for(var i in t._topics)if(t._topics[i])for(var n=0,s=t._topics[i].length;n<s;n++)if(t._topics[i][n].token===e)return t._topics[i].splice(n,1),!0;return!1},e}();e.EventBus=i,angular.module("calypso.services").service("EventBus",i)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=e.Const.API,s=function(){function e(e,t){this.$q=e,this.$http=t,this._cache={},i=this}return e.prototype.get=function(e){var t=i.$q.defer(),s=n.BASE_DEFINITIONS_URI+"/phrasegroup/"+e+"/phrases";return i._cache[e]?t.resolve(i._cache[e]):i.$http.get(s).then(function(n){i._cache[e]=n.data,t.resolve(n.data)}).catch(function(e){console.error("Error: "+e)}),t.promise},e}();s.$inject=["$q","$http"],t.IuclidPhraseGroup=s,angular.module("calypso.services").service("IuclidPhraseGroup",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=function(){function t(t,n,s,c,o){this.$window=t,this.$q=n,this.$http=s,this.EventBus=c,this.ReqBuilder=o,i=this,c.subscribe(e.Const.Events.performSearch,i,i.performSearch)}return t.prototype.search=function(e){var t=i.$q.defer(),n=i.ReqBuilder.getUri(e)+"/raw/SUBSTANCE/8082ace8-26b8-4800-914f-5c44988ebebc";console.log("The Substance uri is "+n);var s=i.ReqBuilder.getData(e);console.log("The Data is "+s);var c={headers:{accept:"application/vnd.iuclid6.ext+json; type=iuclid6.Document","iuclid6-user":"SuperUser","iuclid6-pass":"root"}};return i.$http.get(n,c,s).then(function(e){var n={totalCount:e.data.length,results:e.data};i.enrich(n),t.resolve(n)}).catch(function(e){t.reject(e)}),t.promise},t.prototype.enrich=function(t){var n=e.Const.LocalStorage.FAVORITE_IUCLID_SUBSTANCES,s=i.$window.localStorage.getItem(n),c=s?JSON.parse(s):{};console.log(JSON.stringify(t)),t.results.forEach(function(e){e._favorite=!!c[e.key],console.log(e.name)})},t}();n.$inject=["$window","$q","$http","EventBus","ReqBuilder"],t.IuclidSubstance=n,angular.module("calypso.services").service("IuclidSubstance",n)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=function(){function t(t,n,s,c){this.$rootScope=t,this.EventBus=n,this.DB=s,this.IuclidSubstance=c,i=this,n.subscribe(e.Const.Events.applyFilters,i,i.applyFilters),n.subscribe(e.Const.Events.performSearch,i,i.performSearch)}return t.prototype.buildSearchReq=function(){var e=i.DB.getFilters(),t=Object.keys(e).map(function(t){return e[t]});return{filters:t,sort:i.DB.getSorting(),paging:i.DB.getPaging()}},t.prototype.performSearch=function(){i.$rootScope.loading=!0,i.IuclidSubstance.search(i.buildSearchReq()).then(function(t){i.EventBus.publish(e.Const.Events.loadIuclidSubstances,t),i.$rootScope.loading=!1}).catch(function(e){alert("Error searching for Iuclid Substances"),i.$rootScope.loading=!1})},t.prototype.applyFilters=function(){i.performSearch()},t}();n.$inject=["$rootScope","EventBus","DB","IuclidSubstance"],t.IuclidSubstanceFilter=n,angular.module("calypso.services").service("IuclidSubstanceFilter",n)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=function(){function t(t){this._=t,this.defaultSearchReqData={aq:"",searchHub:"default",language:"en",pipeline:"default",firstResult:0,numberOfResults:e.Const.Paging.DEFAULT_LIMIT,excerptLength:200,filterField:null,enableDidYouMean:!0,sortCriteria:"fieldDescending",sortField:"@tpmillesime",queryFunctions:[],rankingFunctions:[],retrieveFirstSentences:!0,timezone:"America/New_York",enableDuplicateFiltering:!1,enableCollaborativeRating:!1},i=this}return t.prototype.getUri=function(t){return""+e.Const.API.SUBSTANCE_URI},t.prototype.getData=function(e){var t=angular.extend({},i.defaultSearchReqData,{aq:i.getFilters(e.filters),q:i.getMainSearch(e.filters),sortField:"@"+e.sort.field,sortCriteria:e.sort.dir,firstResult:e.paging.offset,numberOfResults:e.paging.limit});return t},t.prototype.getMainSearch=function(e){return(i._.find(e,{key:"main-search"})||{}).submitValue},t.prototype.getFilters=function(e){var t={};e.forEach(function(e){angular.isArray(e)&&e.length>0?t[e[0].category]=e:t[e.category]=e});var i=Object.keys(t);return i.reduce(function(e,i){if("main-search"!==i){var n=t[i];angular.isArray(n)&&n.length>0?n.length>1?(e+="(@"+i+"==(",n.forEach(function(t,i){e+=t.submitValue,e+=i<n.length-1?",":""}),e+="))"):e+="(@"+i+"=="+n[0].submitValue+")":e+="(@"+i+"=="+n.submitValue+")"}return e},"")},t}();n.$inject=["_"],t.ReqBuilder=n,angular.module("calypso.services").service("ReqBuilder",n)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i,n=e.Const.API,s=function(){function e(e,t,n){this.$q=e,this.$http=t,this.$timeout=n,this._treeCache={},i=this}return e.prototype._formatTreeDefinition=function(e){var t={code:e.code,title:e.title,completed:{title:"Completed",documents:[]},required:{title:"Required",documents:[]},optional:{title:"Optional",documents:[]}},i=function(e){e&&e.length>0&&e.forEach(function(e){e.documents.forEach(function(e){e.required===!0?t.required.documents.push(e):t.optional.documents.push(e)}),i(e.sections)})};return i(e.sections),t},e.prototype.getTreeDefinition=function(e){var t=i.$q.defer(),s=n.DOCUMENT_TREE_URI+"/"+e;return i._treeCache[e]?i.$timeout(function(){t.resolve(i._treeCache[e])},50):i.$http.get(s,{headers:{Accept:n.DEFAULT_ACCEPT_HEADER},params:{for:"SUBSTANCE"}}).then(function(n){var s=i._formatTreeDefinition(n.data);i._treeCache[e]=s,t.resolve(s)}).catch(function(e){alert("Failed to Get Tree Definition: "+JSON.stringify(e))}),t.promise},e}();s.$inject=["$q","$http","$timeout"],t.TreeService=s,angular.module("calypso.services").service("TreeService",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidAttachment",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_ATTACHMENT_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidBlock",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_BLOCK_TPL,link:function(e){e.state={collapsed:!0},e.toggleWrapper=function(){e.state.collapsed=!e.state.collapsed}}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidCheckbox",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_CHECKBOX_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidDate",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_DATE_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidNumeric",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_NUMERIC_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidPickList",["IuclidPhraseGroup",function(t){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_PICK_LIST_TPL,link:function(e){e.state={phraseGroup:[]},t.get(e.content.phrasegroup).then(function(t){e.state.phraseGroup=t}).catch(function(e){console.error("Error Getting Phrase Group: "+JSON.stringify(e))})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidRange",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_RANGE_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidText",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_TEXT_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("formToolbar",[function(){return{scope:{document:"="},templateUrl:e.Const.Templates.IUCLID_FORM_TOOLBAR_TPL,link:function(t){t.state={downloadUrl:e.Const.API.BASE_URL+"/txt/"+t.document.identifier}}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidForm",[function(){return{scope:{document:"="},templateUrl:e.Const.Templates.IUCLID_FORM_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidFormContent",[function(){return{scope:{contents:"="},templateUrl:e.Const.Templates.IUCLID_FORM_CONTENTS_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Events;angular.module("calypso.directives").directive("iuclidFormPicker",["$rootScope","$timeout","EventBus","DB","DocumentService",function(t,n,s,c,o){return{scope:{},templateUrl:e.Const.Templates.IUCLID_FORM_PICKER_TPL,link:function(e,n){var a;e.state={document:null,submissionType:null},e.state.submissionType=c.getSubmissionType(),e.loadSubmissionType=function(){s.publish(i.loadSubmissionType,e.state.submissionType)},e.state.submissionType&&e.loadSubmissionType(),s.subscribe(i.loadSubmissionType,e,function(t){e.state.document=null,a=null,e.state.submissionType=t}),s.subscribe(i.loadDocument,e,function(i){a!==i&&(t.loading=!0,o.getDocumentDefinition(i).then(function(t){var s=n[0].querySelector(".iuclid-form-content-wrapper");s&&(s.scrollTop=0),e.state.document=t,a=i}).catch(function(e){alert("Failed to Get Document Definition: "+JSON.stringify(e))}).finally(function(){t.loading=!1}))})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){angular.module("calypso.directives").directive("ngxActiveCls",["$location",function(e){return{restrict:"A",link:function(t,i){function n(){var t=i[0],n=e.path(),s=t.hash?t.hash.replace("#",""):t.pathname;n.split("/")[1]===s.split("/")[1]?t.classList.add("active"):t.classList.remove("active")}t.$on("$locationChangeSuccess",n),n()}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("ngxDropDown",[function(){return{restrict:"E",replace:!0,templateUrl:e.Const.Templates.NGX_DROP_DOWN_TPL,scope:{placeholder:"@",values:"=",onChange:"&"},link:function(e,t){e.data={disabled:!1,value:null},e.data.value=e.placeholder||"Select...",e.select=function(t){e.data.value=t.title,angular.isFunction(e.onChange)&&e.onChange({value:t})},t.bind("click",function(i){i.stopPropagation(),e.data.disabled||t.toggleClass("active")})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){angular.module("calypso.directives").directive("ngxMultiple",[function(){return{restrict:"A",link:function(e,t,i){"true"!==i.ngxMultiple&&i.ngxMultiple!==!0||t.attr("multiple",!0)}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Events,n=e.Const.Templates;angular.module("calypso.directives").directive("sideTree",["$rootScope","EventBus","TreeService",function(e,t,s){return{restrict:"E",scope:{},templateUrl:n.SIDE_TREE_TPL,link:function(n){n.state={tree:null},n.props={selectedCode:null},n.$on("$destroy",function(){t.unsubscribe(c),t.unsubscribe(o)});var c=t.subscribe(i.loadSubmissionType,n,function(t){e.loading=!0,n.props.selectedCode=null,s.getTreeDefinition(t.identifier).then(function(e){n.state.tree=e}).catch(function(e){alert("Failed to Load Tree: "+JSON.stringify(e))}).finally(function(){e.loading=!1})}),o=t.subscribe(i.loadDocument,n,function(e){n.props.selectedCode=e})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var i=e.Const.Events,n=e.Const.Templates;angular.module("calypso.directives").directive("sideTreeSection",["EventBus",function(e){return{restrict:"E",scope:{section:"=",props:"="},templateUrl:n.SIDE_TREE_SECTION_TPL,link:function(t){t.state={collapsed:!0},t.loadNodeDocument=function(t){e.publish(i.loadDocument,t.code)},t.toggleSection=function(e){t.state.collapsed=!t.state.collapsed}}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={})),angular.module("calypso").run(["$templateCache",function(e){e.put("/templates/endpointstudies.html","<h1>endpointstudies</h1>"),e.put("/templates/home.html",'<side-filter filters="calypso.Const.Filters.IUCLID_SUBSTANCE_FILTERS"></side-filter>\n<div class="main-view">\n    <iuclid-substance-list></iuclid-substance-list>\n</div>\n'),e.put("/templates/new-substance.html",'<side-tree></side-tree>\n<div class="main-view">\n    <iuclid-form-picker></iuclid-form-picker>\n</div>\n'),e.put("/templates/not-found.html",'<div ng-init="content = { title: \'Tester 1 2 3\', phrasegroup: \'TD07\' }">\n    <h1>Not Found!</h1>\n    <a href="#/">Home</a>\n    <iuclid-pick-list content="content"></iuclid-pick-list>\n</div>\n'),e.put("/templates/substances.html",'<div class="side-tree">\n    <a href="/#/substances/new" class="btn btn-primary" style="margin-left: 20px;">Create New</a>\n</div>\n<div class="main-view">\n    <h1>Substances</h1>\n</div>\n'),e.put("/templates/directives/iuclid-end-point-study-list.html",'<div class="iuclid-end-point-study-list">\n    <div class="iuclid-end-point-study-list-container">\n        <div ng-repeat="iuclidEndPointStudy in iuclidEndPointStudies class="iuclidEndPointStudy-card" ng-click="openIuclidEndPointStudy(endPointStudy)">\n            <h3>\n                <i ng-class="{\'fa-star\': iuclidEndPointStudy._favorite, \'fa-star-o\': !iuclidEndPointStudy._favorite}"\n                   class="fa" ng-click="favoriteiendPointStudy(iuclidEndPointStudy, $event)"></i>\n                <span class="separator">|</span>\n                {{ iuclidEndPointStudy.title }}\n                <small>{{ iuclidEndPointStudy.raw.tpprixnormal }}</small>\n            </h3>\n            <h5 class="iuclidEndPointStudy-region">{{ iuclidEndPointStudy.raw.tpregion }} | {{ iuclidEndPointStudy.raw.tppays || \' \' }}</h5>\n            <div class="iuclidDocument-details">\n                <img ng-src="{{ iuclidEndPointStudy.raw.tpthumbnailuri }}" class="iuclidEndPointStudy-thumbnail"/>\n                <p class="iuclidEndPointStudy-notes">{{ iuclidEndPointStudy.raw.tpnotededegustation || iuclidEndPointStudy.excerpt.split(\'...\')[0] }}</p>\n            </div>\n        </div>\n        <div ng-if="!iuclidEndPointStudies.length" class="iuclidEndPointStudy-list-empty">\n            <h1><i class="fa fa-cloud"></i></h1>\n            <h2>No Iuclid End Point Studies match your Search!</h2>\n        </div>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-substance-filter.html",'<div>\n    <span class="title">{{ filter.title }}</span>\n    <ul>\n        <li ng-repeat="option in filter.options">\n            <input type="checkbox" ng-if="filter.type === \'checkbox\'" ng-model="option.value" ng-change="onChange(option, iuclidSubstanceSearchFilter)">\n            <label class="checkbox-label" ng-if="filter.type === \'checkbox\'">{{ option.label }}</label>\n        </li>\n    </ul>\n</div>\n'),e.put("/templates/directives/iuclid-substance-list.html",'<div class="iuclid-substance-list">\n    <div class="iuclid-substance-list-container">\n        <div ng-repeat="iuclidSubstance in iuclidSubstances" class="iuclidSubstance-card" ng-click="openIuclidSubstance(iuclidSubstance)">\n            <h3>\n                <i ng-class="{\'fa-star\': iuclidSubstance._favorite, \'fa-star-o\': !iuclidSubstance._favorite}"\n                   class="fa" ng-click="favoriteIuclidSubstance(iuclidSubstance, $event)"></i>\n                <span class="separator">|</span>\n                {{ iuclidSubstance.name }}\n                <small>{{ iuclidSubstance.key }}</small>\n            </h3>\n        </div>\n        <div ng-if="!iuclidSubstances.length" class="iuclidSubstance-list-empty">\n            <h1><i class="fa fa-cloud"></i></h1>\n            <h2>No Iuclid Substances match your Search!</h2>\n        </div>\n    </div>\n</div>\n'),e.put("/templates/directives/search-bar.html",'<div class="search-bar">\n    <a href="/#/endpointstudies" ngx-active-cls>\n        ENDPOINT STUDIES\n    </a>\n    <a href="/#/substances" ngx-active-cls>\n        SUBSTANCES\n    </a>\n    <ngx-drop-down values="data.submissionTypes"\n                   on-change="onSubmissionTypeSelect(value)"\n                   placeholder="Select a Submission Type...">\n    </ngx-drop-down>\n</div>\n'),e.put("/templates/directives/side-filter.html",'<div class="side-filter">\n    <div ng-repeat="filter in filters" class="filter-category">\n        <iuclid-substance-filter filter="filter"></iuclid-substance-filter>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-attachment.html",'<div class="form__content form__content--attachment">\n    <label>{{ content.title }}</label>\n    <input type="file"\n           name="{{ content.name }}"\n           accept="{{ content.mimeType }}"\n           ngx-multiple="{{ !!content.name }}" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-block.html",'<div class="form__content form__content--block"\n        ng-class="{ \'form__content--block--collapsed\': state.collapsed }">\n    <h3 class="form__conent--block__title"\n            ng-click="toggleWrapper()">\n        <i class="fa collapse-toggle"\n           ng-class="{ \'fa-chevron-down\': !state.collapsed, \'fa-chevron-right\': state.collapsed }"> </i>\n        {{ content.title }}\n        <i class="fa fa-check-circle"></i>\n        <!--<i class="fa fa-exclamation-circle"></i>-->\n    </h3>\n    <div class="form__content--block__wrapper">\n        <iuclid-form-content contents="content.contents"></iuclid-form-content>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-checkbox.html",'<div class="form__content form__content--checkbox">\n    <label>{{ content.title }}</label>\n    <input type="checkbox"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-date.html",'<div class="form__content form__content--date">\n    <label>{{ content.title }}</label>\n    <input type="date"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-numeric.html",'<div class="form__content form__content--numeric">\n    <label>{{ content.title }}</label>\n    <input type="number"\n           ng-model="content.value"\n           min="{{ content.min }}"\n           max="{{ content.max }}" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-pick-list.html",'<div class="form__content form__content--pick-list">\n    <label>{{ content.title }}</label>\n\n    <select ng-options="item.phrase.text for item in state.phraseGroup track by item.phrase.code"\n            ng-model="content.value"\n            class="form__content--pick-list__select">\n    </select>\n</div>\n'),
e.put("/templates/directives/iuclid-attributes/iuclid-range.html",'<div class="form__content form__content--range">\n    <label>{{ content.title }}</label>\n    <input type="range"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-text.html",'<div class="form__content form__content--text">\n    <label>{{ content.title }}</label>\n    <!--\n        If the content\'s max length is greater than 256\n        then we should use a text input to provide the\n        ability to provide a larger body of text.\n        Maybe in the future we want to provide some rich\n        text editor?\n    -->\n    <textarea ng-if="content.maxLength && content.maxLength > 256"\n              ng-model="content.value"\n              maxlength="{{ content.maxLength }}">\n    </textarea>\n    <!--\n        Otherwise for type text where the max length is less\n        then 256 we should use a regular text input since\n        it\'s more likely this is a relatively shorter value\n    -->\n    <input ng-if="!content.maxLength || content.maxLength <= 256"\n           type="text"\n           maxlength="{{ content.maxLength }}"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-form/form-toolbar.html",'<div class="form-toolbar">\n    <div class="form-toolbar--filler"></div>\n    <button class="btn">\n        <i class="fa fa-save"></i>\n    </button>\n    <button class="btn">\n        <i class="fa fa-trash"></i>\n    </button>\n    <a href="{{ state.downloadUrl }}" class="btn">\n        <i class="fa fa-download"></i>\n    </a>\n</div>\n'),e.put("/templates/directives/iuclid-form/iuclid-form-contents.html",'<div ng-repeat="content in contents" ng-switch="content.type">\n    <iuclid-block ng-switch-when="block" content="content"></iuclid-block>\n    <iuclid-text ng-switch-when="text" content="content"></iuclid-text>\n    <iuclid-checkbox ng-switch-when="boolean" content="content"></iuclid-checkbox>\n    <iuclid-range ng-switch-when="range" content="content"></iuclid-range>\n    <iuclid-numeric ng-switch-when="numeric" content="content"></iuclid-numeric>\n    <iuclid-pick-list ng-switch-when="picklist" content="content"></iuclid-pick-list>\n    <iuclid-attachment ng-switch-when="attachment" content="content"></iuclid-attachment>\n    <iuclid-date ng-switch-when="date" content="content"></iuclid-date>\n\n    <!--\n        The template for adding new form types is like this:\n        <iuclid-$type ng-switch-when="$type" content="content" ></iculid-$type>\n    -->\n\n    <div ng-switch-default class="form__content">\n        <pre class="no-type-warn">No Form Attribute Implementation for Type:[{{ content.type }}]<br><b>Content:</b> {{ content }}</pre>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-form/iuclid-form-picker.html",'<div class="form-picker__wrapper">\n    <h2 class="form-picker__title" ng-if="state.document">\n        {{ state.document.identifier }}\n        <small>{{ state.document.provider }} {{ state.document.version }}</small>\n    </h2>\n\n    <div ng-if="!state.submissionType" class="empty-state">\n        <h2 class="empty-state__title">Choose a Submission Type</h2>\n        <i class="fa fa-arrow-circle-up empty-state__icon"></i>\n        <p class="empty-state__description">In order to get started creating a new Substance, you first need to select a Submission Type.</p>\n    </div>\n\n    <div ng-if="state.submissionType && !state.document" class="empty-state">\n        <h2 class="empty-state__title">Choose a Document</h2>\n        <i class="fa fa-arrow-circle-left empty-state__icon"></i>\n        <p class="empty-state__description">Select a document from the Tree on the left. Note that there are required vs. optional Documents</p>\n    </div>\n\n    <div ng-if="state.document">\n        <iuclid-form document="state.document"></iuclid-form>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-form/iuclid-form.html",'<div class="iuclid-form">\n    <form-toolbar document="document"></form-toolbar>\n    <div class="iuclid-form-content-wrapper">\n        <iuclid-form-content contents="document.contents"></iuclid-form-content>\n    </div>\n</div>\n'),e.put("/templates/directives/ngx/drop-down.html",'<div class="drop-down__wrapper">\n    <div class="drop-down__label__wrapper">\n        <span class="drop-down__label">{{ data.value }}</span>\n        <i class="fa fa-angle-down"></i>\n    </div>\n    <ul class="drop-down__item-wrapper">\n        <li class="drop-down__item"\n            ng-repeat="item in values"\n            ng-click="select(item)">\n            {{ item.title }}\n        </li>\n    </ul>\n</div>\n'),e.put("/templates/directives/side-tree/side-tree-section.html",'<h3 class="side-tree__section__title"\n        ng-click="toggleSection($event)">\n    <i class="fa collapse-toggle"\n        ng-class="{ \'fa-chevron-down\': !state.collapsed, \'fa-chevron-right\': state.collapsed }"> </i>\n    {{ section.title }}\n    <span class="badge">{{ section.documents.length }}</span>\n</h3>\n<ul class="side-tree__node-container"\n        ng-class="{ \'side-tree__node-container--collapsed\': state.collapsed }">\n    <li class="side-tree__node"\n        ng-class="{ \'side-tree__node--selected\': (props.selectedCode === document.code) }"\n        ng-click="loadNodeDocument(document)"\n        ng-repeat="document in section.documents">\n        {{ document.title }}\n    </li>\n    <li class="empty-state__side-tree-section" ng-if="section.documents.length === 0">\n        <i class="fa fa-folder-open-o"></i>\n        <br/>\n        <span>Nothing here!</span>\n    </li>\n</ul>'),e.put("/templates/directives/side-tree/side-tree.html",'<div class="side-tree" ng-if="state.tree">\n    <side-tree-section section="state.tree.completed" props="props"></side-tree-section>\n    <side-tree-section section="state.tree.required" props="props"></side-tree-section>\n    <side-tree-section section="state.tree.optional" props="props"></side-tree-section>\n</div>\n')}]);