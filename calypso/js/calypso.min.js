!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("FuzzySearch",[],t):"object"==typeof exports?exports.FuzzySearch=t():e.FuzzySearch=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(1),c=i(a);e.exports=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(s(this,e),0===t.length)throw new Error("We need an array containing the search list");this.haystack=t,this.keys=n,this.options=c.default.extend({caseSensitive:!1,sort:!1},i)}return o(e,[{key:"search",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)return this.haystack;for(var n=[],i=0;i<this.haystack.length;i++){var s=this.haystack[i];if(0===this.keys.length){var o=e.isMatch(s,t,this.options.caseSensitive);o&&n.push({item:s,score:o})}else for(var a=0;a<this.keys.length;a++){for(var r=c.default.getDescendantProperty(s,this.keys[a]),l=!1,u=0;u<r.length;u++){var d=e.isMatch(r[u],t,this.options.caseSensitive);if(d){l=!0,n.push({item:s,score:d});break}}if(l)break}}return this.options.sort&&n.sort(function(e,t){return e.score-t.score}),n.map(function(e){return e.item})}}],[{key:"isMatch",value:function(e,t,n){n||(e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase());for(var i=t.split(""),s=[],o=0,a=0;a<i.length;a++){var c=i[a];if(o=e.indexOf(c,o),o===-1)return!1;s.push(o),o++}for(var r=1,l=0;l<s.length;l++)l!==s.length-1&&(r+=s[l+1]-s[l]);return r}}]),e}()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){n(this,e)}return i(e,null,[{key:"extend",value:function(){for(var t={},n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];for(var o=0;o<i.length;o++){var a=i[o];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&("[object Object]"===Object.prototype.toString.call(a[c])?t[c]=e.extend(t[c],a[c]):t[c]=a[c])}return t}},{key:"getDescendantProperty",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=void 0,o=void 0,a=void 0,c=void 0,r=void 0,l=void 0;if(n){if(a=n.indexOf("."),a===-1?s=n:(s=n.slice(0,a),o=n.slice(a+1)),c=t[s],null!==c&&"undefined"!=typeof c)if(o||"string"!=typeof c&&"number"!=typeof c)if("[object Array]"===Object.prototype.toString.call(c))for(r=0,l=c.length;r<l;r++)e.getDescendantProperty(c[r],o,i);else o&&e.getDescendantProperty(c,o,i);else i.push(c)}else i.push(t);return i}}]),e}();t.default=s}])});var calypso;!function(e){var t;!function(e){var t;!function(e){e.DEFAULT_ACCEPT_HEADER="application/vnd.iuclid6.ext+json",e.DEFINITION_ACCEPT_HEADER="application/vnd.iuclid6.ext+json;type=iuclid6.Definition",e.DOCUMENT_CONTENT_TYPE_HEADER="application/vnd.iuclid6.ext+json; type=iuclid6.Document",e.BASE_URL="https://iuclid.ca/api",e.BASE_URI=e.BASE_URL+"/iuclid6-ext/api/ext/v1",e.BASE_DEFINITIONS_URI=e.BASE_URI+"/definition",e.BASE_API_URI=e.BASE_URI+"/query/iuclid6",e.BASE_RAW_URI=e.BASE_URI+"/raw",e.SUBMISSION_TYPES_URI=e.BASE_DEFINITIONS_URI+"/submissiontypes",e.DOCUMENT_TREE_URI=e.BASE_DEFINITIONS_URI+"/tree",e.SUBSTANCE_URI=e.BASE_URI,e.END_POINT_STUDY_URI=e.BASE_URI+"/endpointstudy"}(t=e.API||(e.API={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){e.Entities={substances:{docType:"SUBSTANCE",displayName:"Substance",title:"Substances",state:"entities.substances",legal:!0,sections:!0},mixtures:{docType:"MIXTURE",displayName:"Mixture",title:"Mixtures",state:"entities.mixtures",legal:!0,sections:!0},templates:{docType:"TEMPLATE",displayName:"Template",title:"Templates",state:"entities.templates",legal:!0,sections:!0},categories:{docType:"CATEGORY",displayName:"Category",title:"Categories",state:"entities.categories",legal:!0,sections:!1},literature:{docType:"LITERATURE",displayName:"Literature",title:"Literature",state:"entities.literature",legal:!1,sections:!1},dossier:{docType:"DOSSIER",displayName:"Dossier",title:"Dossier",state:"entities.dossier",legal:!1,sections:!0},"legal-entities":{docType:"LEGAL_ENTITY",displayName:"Legal Entity",title:"Legal Entities",state:"entities.legal-entities",legal:!1,sections:!1},annotations:{docType:"ANNOTATION",displayName:"Annotation",title:"Annotations",state:"entities.annotation",legal:!1,sections:!1},sites:{docType:"SITE",displayName:"Site",title:"Sites",state:"entities.site",legal:!0,sections:!1},"reference-substances":{docType:"REFERENCE_SUBSTANCE",displayName:"Reference Substance",title:"Reference Substances",state:"entities.reference-substances",legal:!1,sections:!1},contacts:{docType:"CONTACT",displayName:"Contact",title:"Contacts",state:"entities.contacts",legal:!1,sections:!1}}}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.addFilter="filter.add",e.afterAddFilter="filter.add.after",e.removeFilter="filter.remove",e.afterRemoveFilter="filter.remove.after",e.applyFilters="filter.apply",e.afterApplyFilters="filter.apply.after",e.loadIuclidEndPointStudies="iuclidEndPointStudy.load",e.loadSubstances="substances.load",e.searchSubstances="search.load",e.loadSubmissionType="submission-type.load",e.loadDocumentDefinition="documentDefinition.load",e.loadDocumentData="documentData.load",e.filterDocumentDefinition="documentDefinition.filter",e.entitySearch="entity.search",e.toggleSideBar="side-bar.toggle",e.hideSideBar="side-bar.hide",e.collapseAllSideBarSections="side-bar.sections.collapse",e.setCompletedSections="completed-sections.set",e.setTitle="title.set",e.collapseAllSections="sections.collapse",e.loadTabs="tabs.load"}(t=e.Events||(e.Events={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.Sort={ASC:"fieldAscending",DESC:"fieldDescending"},e.ORGANIZATION={title:"Organization",type:"checkbox",category:"ORGANIZATION",options:[{category:"ORGANIZATION",key:"OECD",label:"OECD",value:!1,submitValue:"OECD",multi:!1},{category:"ORGANIZATION",key:"HC",label:"Health Canada",value:!1,submitValue:"HC",multi:!1},{category:"ORGANIZATION",key:"EC",label:"Environment Canada and Climate Change",value:!1,submitValue:"EC",multi:!1}]},e.IUCLID_SUBSTANCE_FILTERS=[e.ORGANIZATION]}(t=e.Filters||(e.Filters={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.FAVORITE_IUCLID_END_POINT_STUDIES="calypso.iuclidEndPointStudies.favorites",e.FAVORITE_IUCLID_SUBSTANCES="calypso.iuclidSubstances.favorites"}(t=e.LocalStorage||(e.LocalStorage={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){e.DEFAULT_LIMIT=20}(t=e.Paging||(e.Paging={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t;!function(e){var t="/templates/";e.ENTITIES_TPL=t+"entities.html",e.ENTITIES_LIST_TPL=t+"entities-list.html",e.NEW_ENTITY_TPL=t+"new-entity.html",e.EDIT_ENTITY_TPL=t+"edit-entity.html",e.SUBSTANCES_TPL=t+"substances.html",e.NEW_SUBSTANCE_TPL=t+"new-substance.html",e.ENDPOINTSTUDIES_TPL=t+"endpointstudies.html",e.HOME_TPL=t+"home.html",e.NOT_FOUND_TPL=t+"not-found.html",e.GENERIC_FORM_TPL=t+"directives/generic-form.html",e.SEARCH_BAR_TPL=t+"directives/search-bar.html",e.SIDE_FILTER_TPL=t+"directives/side-filter.html",e.SIDE_TREE_TPL=t+"directives/side-tree/side-tree.html",e.SIDE_TREE_SECTION_TPL=t+"directives/side-tree/side-tree-section.html",e.ENTITY_LIST_TPL=t+"directives/entity-list.html",e.IUCLID_SUBSTANCE_FILTER_TPL=t+"directives/iuclid-substance-filter.html",e.IUCLID_END_POINT_STUDY_FILTER_TPL=t+"directives/iuclid-end-point-study-filter.html",e.IUCLID_END_POINT_STUDY_LIST_TPL=t+"directives/iuclid-end-point-study-list.html",e.BREADCRUMB_TPL=t+"directives/breadcrumbs.html",e.PAGING_TPL=t+"directives/paging.html",e.IUCLID_FORM_TPL=t+"directives/iuclid-form/iuclid-form.html",e.IUCLID_FORM_TABS_TPL=t+"directives/iuclid-form/form-tabs.html",e.IUCLID_FORM_TOOLBAR_TPL=t+"directives/iuclid-form/form-toolbar.html",e.IUCLID_FORM_CONTENTS_TPL=t+"directives/iuclid-form/iuclid-form-contents.html",e.IUCLID_FORM_PICKER_TPL=t+"directives/iuclid-form/iuclid-form-picker.html",e.IUCLID_ATTRIBUTE_BLOCK_TPL=t+"directives/iuclid-attributes/iuclid-block.html",e.IUCLID_ATTRIBUTE_CHECKBOX_TPL=t+"directives/iuclid-attributes/iuclid-checkbox.html",e.IUCLID_ATTRIBUTE_TEXT_TPL=t+"directives/iuclid-attributes/iuclid-text.html",e.IUCLID_ATTRIBUTE_PICK_LIST_TPL=t+"directives/iuclid-attributes/iuclid-pick-list.html",e.IUCLID_ATTRIBUTE_ATTACHMENT_TPL=t+"directives/iuclid-attributes/iuclid-attachment.html",e.IUCLID_ATTRIBUTE_RANGE_TPL=t+"directives/iuclid-attributes/iuclid-range.html",e.IUCLID_ATTRIBUTE_NUMERIC_TPL=t+"directives/iuclid-attributes/iuclid-numeric.html",e.IUCLID_ATTRIBUTE_DATE_TPL=t+"directives/iuclid-attributes/iuclid-date.html",e.NGX_DROP_DOWN_TPL=t+"directives/ngx/drop-down.html"}(t=e.Templates||(e.Templates={}))}(t=e.Const||(e.Const={}))}(calypso||(calypso={}));var calypso;!function(e){var t=e.Const.Templates;angular.module("calypso.services",[]),angular.module("calypso.directives",[]),angular.module("calypso",["ui.router","calypso.services","calypso.directives"]),angular.module("calypso").constant("_",_),angular.module("calypso").constant("FuzzySearch",window.FuzzySearch),angular.module("calypso").config(["$stateProvider","$urlRouterProvider","$compileProvider",function(n,i,s){s.debugInfoEnabled(!1),n.state({name:"entities",url:"/entities",template:"<entity-page></entity-page>"}),Object.keys(e.Const.Entities).forEach(function(t){var i=e.Const.Entities[t];i.name=t,n.state({name:"entities."+t,url:"/"+t,template:"<entity-list></entity-list>",data:i})}),n.state({name:"new-entity",url:"/entities/:entityType/new",template:"<new-entity></new-entity>"}),n.state({name:"edit-entity",url:"/entities/:entityType/:entityKey/:snapshot",template:"<edit-entity></edit-entity>"}),n.state({name:"entities.endpointstudies",url:"/endpointstudies",templateUrl:t.ENDPOINTSTUDIES_TPL}),n.state({name:"not-found",url:"/not-found",templateUrl:t.NOT_FOUND_TPL}),i.when("","/entities/substances"),i.when("/","/entities/substances"),i.when("/entities","/entities/substances"),i.otherwise("/not-found")}]),angular.module("calypso").run(["AppConfig",function(e){e.loadSubmissionTypes("SUBSTANCE")}])}(calypso||(calypso={})),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e});var calypso;!function(e){var t;!function(t){var n=e.Const.Templates,i=e.Const.Events;angular.module("calypso.directives").directive("editEntity",["$timeout","$parse","$stateParams","EventBus","DB","DocumentService",function(e,t,s,o,a,c){return{restrict:"E",scope:{},templateUrl:n.EDIT_ENTITY_TPL,link:function(n){var r=a.getEntityContext();n.state={context:r},o.publish(i.setTitle,"Editing "+t("displayName")(r)),r.sections&&c.getDocumentSections(r.docType,s.entityKey).then(function(t){t=t||[];var n=t.reduce(function(e,t){var n=t.representation[0];return e[n.definition]=!0,e},{});a.setCompletedSections(n),e(function(){o.publish(i.setCompletedSections,n)},100)}).catch(function(){alert("Failed to get Document Sections")}),e(function(){o.publish(i.loadDocumentDefinition,r.docType)},100)}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Templates;angular.module("calypso.directives").directive("entityList",["$timeout","$parse","$state","DB","EventBus","Entity","Loading",function(e,t,i,s,o,a,c){return{restrict:"E",scope:{},templateUrl:n.ENTITY_LIST_TPL,link:function(e){var n=(s.getEntityContext(),i.current.data.docType);e.entityDocType=n,e.entityDisplayName=i.current.data.displayName,e.entityUrl=i.current.url,e.entities=s.getEntities(n);var o=function(){c.show(),a.performSearch({docType:n}).then(function(t){t.docType=n,angular.isArray(e.entities)?(e.entities.splice(0,e.entities.length),e.entities.push.apply(e.entities,t.results)):(e.entities=t.results,s.setEntities(n,e.entities))}).catch(function(e){console.error("Error Searching for "+n+": "+JSON.stringify(e))}).finally(function(){c.hide()})};e.refresh=o,e.deleteEntity=function(n,i){var s="Are you sure you want to delete '"+(n.representation.publicName||n.representation.name)+"'";"4f88bc7f-395c-4d0b-997b-14e8c9aef605/0"===t("representation.key")(n)?alert("Preventing Deletion of Predefined Legal Entity - This is necessary for creating Entities"):window.confirm(s)&&(c.show(),a.deleteEntity(n).then(function(){e.entities.splice(i,1)}).catch(function(e){console.error("Error Deleting Entity: "+JSON.stringify(e))}).finally(function(){c.hide()}))},o()}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Templates,i=e.Const.Events;angular.module("calypso.directives").directive("entityPage",["$rootScope","$timeout","$parse","$state","DB","EventBus",function(e,t,s,o,a,c){return{restrict:"E",scope:{},templateUrl:n.ENTITIES_TPL,link:function(n){var o=a.getEntityContext();n.state={new_link:s("name")(o),treeOpen:!1},c.publish(i.setTitle,""+s("title")(o));var r=function(){var e=a.getEntityContext();n.state.new_link=s("name")(e),c.publish(i.setTitle,""+s("title")(e))};r();var l=function(){n.state.treeOpen=!n.state.treeOpen,n.state.treeOpen?e.overlay=!0:t(function(){e.overlay=!1},200)},u=function(){n.state.treeOpen=!1,e.overlay=!1},d=e.$on("$stateChangeSuccess",function(){u(),r()}),p=c.subscribe(i.toggleSideBar,n,l),f=c.subscribe(i.hideSideBar,n,u);n.$on("$destroy",function(){d(),c.unsubscribe(p),c.unsubscribe(f)})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Templates,i=e.Const.Events;angular.module("calypso.directives").directive("newEntity",["$timeout","$rootScope","$parse","$stateParams","EventBus","DB",function(e,t,s,o,a,c){return{restrict:"E",scope:{},templateUrl:n.NEW_ENTITY_TPL,link:function(){t.overlay=!1;var n=c.getEntityContext();a.publish(i.setTitle,"New "+s("displayName")(n)),n?e(function(){a.publish(i.loadDocumentDefinition,n.docType)},50):alert("Unknown Entity Context: "+o.entityType)}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Templates,i=e.Const.Events;angular.module("calypso.directives").directive("searchBar",["$rootScope","$state","$stateParams","DB","EventBus",function(t,s,o,a,c){return{restrict:"E",replace:!0,scope:{},templateUrl:n.SEARCH_BAR_TPL,link:function(n){n.state={showHamburger:!0},n.toggleSidebar=function(){c.publish(i.toggleSideBar)},n.goHome=function(e){e.preventDefault();var t=a.getEntityContext();s.go(t.state||"entities.substances")},t.$on("$stateChangeSuccess",function(){if(t.overlay=!1,"entities"===s.current.name)s.go("entities.substances");else if(o.entityType){var i=a.getEntityContext();o.entityKey&&angular.isObject(i)||a.setEntityContext(e.Const.Entities[o.entityType])}else a.setEntityContext(s.current.data);var c=a.getEntityContext();n.state.showHamburger=!o.entityKey||c.sections}),c.subscribe(i.setTitle,n,function(e){angular.isString(e)&&(n.state.title=e)})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Templates;angular.module("calypso.directives").directive("sideFilter",[function(){return{restrict:"E",scope:{filters:"="},templateUrl:n.SIDE_FILTER_TPL,link:function(t){console.log("FILTERS:"+t.filters),t.filters=e.Const.Filters.IUCLID_SUBSTANCE_FILTERS}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.API,s=function(){function e(e,t){this.$http=e,this.DB=t,n=this}return e.prototype.loadSubmissionTypes=function(e){n.$http.get(i.SUBMISSION_TYPES_URI,{headers:{Accept:i.DEFINITION_ACCEPT_HEADER},params:{for:e}}).then(function(e){n.DB.setSubmissionTypes(e.data)}).catch(function(e){console.error("Failed to load Submission Types: "+JSON.stringify(e))})},e}();s.$inject=["$http","DB"],t.AppConfig=s,angular.module("calypso.services").service("AppConfig",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.getUser=function(){return"SuperUser"},e.prototype.getPass=function(){return"%PASSWORD%"},e}();e.Credentials=t,angular.module("calypso.services").service("Credentials",t)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.API,s=function(){function e(e){this.$http=e,this._fields=[{label:"Substance",value:"substance",default:"X"},{label:"Test organism",value:"organism",default:"X"},{label:"Endpoint",value:"endpoint",default:"X"},{label:"Value (mg/L)",value:"value",default:"X"},{label:"Reference",value:"reference",default:"X"}],this._data=[{substance:"Malachite green",organism:"Rainbow trout (Oncorhynchus mykiss)",endpoint:"21 d EC50 growth rate",value:.68,reference:"Smith et al. 2017"},{substance:"Crystal violet",organism:"Water flea (Daphnia magna)",endpoint:"48 h EC50 immobilization",value:4.5,reference:"Johnson and Jones 2010"},{substance:void 0,organism:void 0,endpoint:"96 h LC50 mortality",value:void 0,reference:void 0}],n=this}return e.prototype.download=function(e){n.$http.post(i.BASE_URL+"/csv/"+e.identifier,{fields:n._fields,data:n._data}).then(function(t){var n=new Blob([t.data]),i=document.createElement("a");i.href=window.URL.createObjectURL(n),i.download=e.identifier+".csv",i.click()}).catch(function(e){alert("Unable to download CSV at this time!")})},e}();s.$inject=["$http"],t.CSV=s,angular.module("calypso.services").service("CSV",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=function(){function t(t,i,s){this.$parse=t,this._=i,this.EventBus=s,n=this,n._db={submissionTypes:[],submissionType:null,entities:{},entityContext:null,completedSections:{},paging:{offset:0,limit:e.Const.Paging.DEFAULT_LIMIT}},s.subscribe(e.Const.Events.loadSubstances,n,n.loadSubstances)}return t.prototype.setSubmissionTypes=function(e){var t=n.getSubmissionTypes();t.splice(0,t.length),t.push.apply(t,e)},t.prototype.getSubmissionTypes=function(){return n.$parse("_db.submissionTypes")(n)},t.prototype.setSubmissionType=function(e){n._db.submissionType=e},t.prototype.getSubmissionType=function(){return n.$parse("_db.submissionType")(n)},t.prototype.loadEntities=function(e){var t=e.results,i=n.getEntities(e.docType);i.splice(0,i.length),i.push.apply(i,t)},t.prototype.getEntities=function(e){return n.$parse("_db.entities."+e)(n)},t.prototype.setEntities=function(e,t){n._db.entities[e]=t},t.prototype.getPaging=function(){return n.$parse("_db.paging")(n)},t.prototype.setPaging=function(e){n._db.paging=e},t.prototype.getEntityContext=function(){return n.$parse("_db.entityContext")(n)},t.prototype.setEntityContext=function(e){n._db.entityContext=e},t.prototype.getCompletedSections=function(){return n.$parse("_db.completedSections")(n)},t.prototype.setCompletedSections=function(e){n._db.completedSections=e},t}();i.$inject=["$parse","_","EventBus"],t.DB=i,angular.module("calypso.services").service("DB",i)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.Events,s=function(){function e(e){this.EventBus=e,this.filtersApplied=!0,this.filters={filter:{OwnerLegalEntityProtection:!0,ThirdPartyProtection:!0,ThirdParty:!0,OwnerLegalEntity:!0,"RoleInSupplyChain.RoleProtection":!0,"RoleInSupplyChain.Importer":!0,OtherNames:!0},replace:{ChemicalName:{attribute:"title",value:"CHEMICAL NAME"},PublicName:{attribute:"title",value:"PUBLIC NAME"},"ApplicantSummaryAndConclusion.ValidityCriteriaFulfilled":{attribute:"title",value:"Applicable in Canada"}}},n=this}return e.prototype.getDefinitionFilter=function(){return n.filters},e.prototype.isApplied=function(){return n.filtersApplied},e.prototype.toggle=function(){n.filtersApplied=!n.filtersApplied,n.EventBus.publish(i.filterDocumentDefinition,n.filtersApplied)},e}();s.$inject=["EventBus"],t.DocumentFilter=s,angular.module("calypso.services").service("DocumentFilter",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.API,s=function(){function e(e,t,i,s,o,a,c,r){this.$q=e,this.$http=t,this.$timeout=i,this.$parse=s,this.$stateParams=o,this.DB=a,this.Credentials=c,this.DocumentFilter=r,this._cache={},n=this}return e.prototype.getDocumentDefinition=function(e){var t=n.$q.defer(),s=i.BASE_DEFINITIONS_URI+"/document/"+e;return n._cache[e]?n.$timeout(function(){t.resolve(angular.copy(n._cache[e]))},50):n.$http.get(s,{params:{_c:(new Date).getTime()},headers:{Accept:i.DEFINITION_ACCEPT_HEADER}}).then(function(i){n._cache[e]=angular.copy(i.data),t.resolve(i.data)}).catch(function(e){alert("Failed to Get Document Definition: "+JSON.stringify(e)),t.reject(e)}),t.promise},e.prototype.getDocumentSections=function(e,t){var s=n.$q.defer(),o=i.BASE_RAW_URI+"/"+e+"/"+t+"/documents";return n.$http.get(o,{params:{formatter:"iuclid6.Document",l:"1000"},headers:{"iuclid6-user":n.Credentials.getUser(),"iuclid6-pass":n.Credentials.getPass(),Accept:i.DOCUMENT_CONTENT_TYPE_HEADER}}).then(function(e){s.resolve(e.data.results)}).catch(function(e){s.reject(e)}),s.promise},e.prototype.getDocumentData=function(e,t,s){var o=n.$q.defer(),a=i.BASE_RAW_URI+"/"+e+"/"+t+"/document/"+s;return n.$http.get(a,{params:{formatter:"iuclid6.Document"},headers:{"iuclid6-user":n.Credentials.getUser(),"iuclid6-pass":n.Credentials.getPass()}}).then(function(e){o.resolve(e.data.results)}).catch(function(e){o.reject(e)}),o.promise},e.prototype.filter=function(e){var t=n.DocumentFilter.getDefinitionFilter(),i=function(e,n){return e=e.filter(function(e){var i=""===n?e.name:n+"."+e.name;return t.filter[i]!==!0}),e.forEach(function(e){var s=""===n?e.name:n+"."+e.name;if(t.replace[s]){var o=t.replace[s];e[o.attribute]=o.value}"block"===e.type&&(e.contents=i(e.contents,s))}),e};e.contents=i(e.contents,"")},e.prototype.apply=function(e,t){n.eachContent(e.contents,function(e,i){if("block"!==e.type){var s=n.$parse(i)(t);if(s)switch(e.type){case"boolean":case"text":e.value=s;break;case"picklist":e.value=s.code}}})},e.prototype.generateJsonDocumentEnvelope=function(e,t){var i=n.DB.getEntityContext(),s={},o=e.contents.reduce(n.generateJsonBody,t||{})||{};return i.sectionCode&&i.sectionCode!==i.docType?(s.definition=i.sectionCode,i.sectionUuid&&(s.key=i.sectionUuid)):(s.definition=i.docType,n.$stateParams.entityKey&&(s.key=n.$stateParams.entityKey)),i.sectionCode===i.docType&&i.legal&&(o.OwnerLegalEntity="4f88bc7f-395c-4d0b-997b-14e8c9aef605/0"),[s,o]},e.prototype.delete=function(e,t,s,o){var a=n.$q.defer(),c=i.BASE_RAW_URI+"/"+e+"/"+t;s&&o&&(c+="/document/"+s+"/"+o);var r={url:c,method:"DELETE",headers:{"iuclid6-user":n.Credentials.getUser(),"iuclid6-pass":n.Credentials.getPass()}};return n.$http(r).then(function(e){a.resolve(e.data)}).catch(function(e){a.reject(e)}),a.promise},e.prototype.save=function(e){var t=n.$q.defer(),s=n.DB.getEntityContext(),o=n.$stateParams.entityKey,a=!0,c=e[0],r=i.BASE_RAW_URI+"/"+s.docType;o&&(a=!1,r+="/"+o,s.sectionCode&&s.sectionCode!==s.docType&&(s.sectionUuid?(a=!1,r+="/document/"+s.sectionCode+"/"+s.sectionUuid):(a=!0,r+="/document/"+s.sectionCode)));var l={url:r,method:a?"POST":"PUT",data:e,headers:{"Content-Type":i.DOCUMENT_CONTENT_TYPE_HEADER,"iuclid6-user":n.Credentials.getUser(),"iuclid6-pass":n.Credentials.getPass()}};return n.$http(l).then(function(n){if(a){var i=n.data.source.split("/");c.key=i[i.length-1]}t.resolve({isCreate:a,header:c,body:e[1]})}).catch(function(e){t.reject(e)}),t.promise},e.prototype.generateJsonBody=function(e,t){switch(e=e||{},t.type){case"block":e[t.name]=t.contents.reduce(n.generateJsonBody,{});break;case"boolean":case"text":t.value&&(e[t.name]=t.value);break;case"picklist":t.value&&(e[t.name]={code:t.value})}return Object.keys(e).forEach(function(t){void 0===e[t]&&delete e[t]}),Object.keys(e).length>0?e:void 0},e.prototype.eachContent=function(e,t){var n=function(e,i){e.forEach(function(e,s){var o=""===i?e.name:i+"."+e.name;t(e,o),"block"===e.type&&n(e.contents,o)})};n(e,"")},e.prototype.deleteAttr=function(e,t){var i=t.split("."),s=i.pop(),o=i.join("."),a=n.$parse(o)(e);delete a[s]},e}();s.$inject=["$q","$http","$timeout","$parse","$stateParams","DB","Credentials","DocumentFilter"],t.DocumentService=s,angular.module("calypso.services").service("DocumentService",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.Events,s=e.Const.API,o=function(){function t(t,i,s,o,a,c){this.$window=t,this.$q=i,this.$http=s,this.EventBus=o,this.Credentials=a,this.ReqBuilder=c,n=this,o.subscribe(e.Const.Events.searchSubstances,n,n.performSearch)}return t.prototype.search=function(e){var t=n.$q.defer();return n.performSearch({docType:e}).then(function(t){t.docType=e,n.EventBus.publish(i.loadSubstances,t)}).catch(function(e){alert("Error: "+JSON.stringify(e))}).finally(function(){t.resolve()}),t.promise},t.prototype.performSearch=function(e){var t=n.$q.defer(),i=s.BASE_API_URI+"/byType";return n.$http.get(i,{params:{"doc.type":e.docType,l:20,o:0,count:!0,order:"modified-",formatter:"iuclid6.DocumentSecuredRepresentation"},headers:{Accept:s.DEFAULT_ACCEPT_HEADER,"iuclid6-user":n.Credentials.getUser(),"iuclid6-pass":n.Credentials.getPass()}}).then(function(e){t.resolve(e.data)}).catch(function(e){t.reject(e)}),t.promise},t.prototype.deleteEntity=function(e){var t=n.$q.defer(),i=e.representation.definition,o=e.representation.key.split("/")[0],a=s.BASE_RAW_URI+"/"+i+"/"+o;return n.$http.delete(a,{headers:{"iuclid6-user":n.Credentials.getUser(),"iuclid6-pass":n.Credentials.getPass()}}).then(function(){t.resolve()}).catch(function(e){t.reject(e)}),t.promise},t}();o.$inject=["$window","$q","$http","EventBus","Credentials","ReqBuilder"],t.Entity=o,angular.module("calypso.services").service("Entity",o)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t,n=function(){function e(){t=this,t._topics={},t._subUid=-1}return e.prototype.subscribe=function(e,n,i,s){t._topics[e]||(t._topics[e]=[]);var o=(++t._subUid).toString();return t._topics[e].push({token:o,handler:i,scope:n,priority:s||1e4}),o},e.prototype.publish=function(e,n){if(!t._topics[e])return!1;var i=t._topics[e],s=i?i.length:0;return s>0&&i.sort(function(e,t){return e.priority-t.priority}).forEach(function(e){angular.isFunction(e.handler)&&e.handler.call(e.scope,n)}),!0},e.prototype.unsubscribe=function(e){for(var n in t._topics)if(t._topics[n])for(var i=0,s=t._topics[n].length;i<s;i++)if(t._topics[n][i].token===e)return t._topics[n].splice(i,1),!0;return!1},e}();e.EventBus=n,angular.module("calypso.services").service("EventBus",n)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.API,s=function(){function e(e,t){this.$q=e,this.$http=t,this._cache={},n=this}return e.prototype.get=function(e){var t=n.$q.defer(),s=i.BASE_DEFINITIONS_URI+"/phrasegroup/"+e+"/phrases";return n._cache[e]?t.resolve(n._cache[e]):n.$http.get(s).then(function(i){n._cache[e]=i.data,t.resolve(i.data)}).catch(function(e){console.error("Error: "+e)}),t.promise},e}();s.$inject=["$q","$http"],t.IuclidPhraseGroup=s,angular.module("calypso.services").service("IuclidPhraseGroup",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){var t,n=function(){function e(e){this.$rootScope=e,this._shows=0,t=this}return e.prototype.show=function(){t._shows+=1,t.$rootScope.loading=!0},e.prototype.hide=function(){t._shows-=1,t._shows<=0&&(t.$rootScope.loading=!1,t._shows=0)},e}();n.$inject=["$rootScope"],e.Loading=n,angular.module("calypso.services").service("Loading",n)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=function(){function t(t){this._=t,this.defaultSearchReqData={aq:"",searchHub:"default",language:"en",pipeline:"default",firstResult:0,numberOfResults:e.Const.Paging.DEFAULT_LIMIT,excerptLength:200,filterField:null,enableDidYouMean:!0,sortCriteria:"fieldDescending",sortField:"@tpmillesime",queryFunctions:[],rankingFunctions:[],retrieveFirstSentences:!0,timezone:"America/New_York",enableDuplicateFiltering:!1,enableCollaborativeRating:!1},n=this}return t.prototype.getUri=function(t){return""+e.Const.API.SUBSTANCE_URI},t.prototype.getData=function(e){var t=angular.extend({},n.defaultSearchReqData,{aq:n.getFilters(e.filters),q:n.getMainSearch(e.filters),sortField:"@"+e.sort.field,sortCriteria:e.sort.dir,firstResult:e.paging.offset,numberOfResults:e.paging.limit});return t},t.prototype.getMainSearch=function(e){return(n._.find(e,{key:"main-search"})||{}).submitValue},t.prototype.getFilters=function(e){var t={};e.forEach(function(e){angular.isArray(e)&&e.length>0?t[e[0].category]=e:t[e.category]=e});var n=Object.keys(t);return n.reduce(function(e,n){if("main-search"!==n){var i=t[n];angular.isArray(i)&&i.length>0?i.length>1?(e+="(@"+n+"==(",i.forEach(function(t,n){e+=t.submitValue,e+=n<i.length-1?",":""}),e+="))"):e+="(@"+n+"=="+i[0].submitValue+")":e+="(@"+n+"=="+i.submitValue+")"}return e},"")},t}();i.$inject=["_"],t.ReqBuilder=i,angular.module("calypso.services").service("ReqBuilder",i)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n,i=e.Const.API,s=function(){function e(e,t,i,s){this.$q=e,this.$http=t,this.$timeout=i,this.DB=s,this._treeCache={},n=this}return e.prototype._formatTreeDefinition=function(e){var t=n.DB.getCompletedSections(),i={code:e.code,title:e.title,sections:{completed:{title:"Completed",documents:[]},required:{title:"Required",documents:[]},endpointStudies:{title:"Endpoint Studies",documents:[]},endpointSummaries:{title:"Endpoint Summaries",documents:[]},others:{title:"Others",documents:[]}}},s=function(e){e&&e.length>0&&e.forEach(function(e){e.documents.forEach(function(e){t[e.code]?i.sections.completed.documents.push(e):e.required===!0?i.sections.required.documents.push(e):e.code.toUpperCase().startsWith("ENDPOINT_STUDY_RECORD")?i.sections.endpointStudies.documents.push(e):e.code.toUpperCase().startsWith("ENDPOINT_SUMMARY")?i.sections.endpointSummaries.documents.push(e):i.sections.others.documents.push(e)}),s(e.sections)})};return s(e.sections),i},e.prototype.getTreeDefinition=function(e,t){var s=n.$q.defer(),o=i.DOCUMENT_TREE_URI+"/"+e;return n._treeCache[e]&&!t?n.$timeout(function(){var t=n._formatTreeDefinition(n._treeCache[e]);s.resolve(t)},50):n.$http.get(o,{headers:{Accept:i.DEFAULT_ACCEPT_HEADER},params:{for:"SUBSTANCE"}}).then(function(t){n._treeCache[e]=t.data;var i=n._formatTreeDefinition(t.data);s.resolve(i)}).catch(function(e){alert("Failed to Get Tree Definition: "+JSON.stringify(e));
}),s.promise},e}();s.$inject=["$q","$http","$timeout","DB"],t.TreeService=s,angular.module("calypso.services").service("TreeService",s)}(t=e.Services||(e.Services={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidAttachment",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_ATTACHMENT_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Events;angular.module("calypso.directives").directive("iuclidBlock",["EventBus",function(t){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_BLOCK_TPL,link:function(e){e.state={expanded:!1},e.toggleWrapper=function(){e.state.expanded=!e.state.expanded};var i=t.subscribe(n.collapseAllSections,e,function(){e.state.expanded=!1});e.$on("$destroy",function(){t.unsubscribe(i)})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidCheckbox",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_CHECKBOX_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidDate",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_DATE_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidNumeric",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_NUMERIC_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidPickList",["IuclidPhraseGroup",function(t){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_PICK_LIST_TPL,link:function(e){e.state={phraseGroup:[]},t.get(e.content.phrasegroup).then(function(t){e.state.phraseGroup=t}).catch(function(e){console.error("Error Getting Phrase Group: "+JSON.stringify(e))})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidRange",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_RANGE_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidText",[function(){return{scope:{content:"="},templateUrl:e.Const.Templates.IUCLID_ATTRIBUTE_TEXT_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Events;angular.module("calypso.directives").directive("formTabs",["EventBus",function(t){return{scope:{documentDefinitions:"="},templateUrl:e.Const.Templates.IUCLID_FORM_TABS_TPL,link:function(e){e.state={definitions:null},e.addTab=function(){alert("Unfortunately multiple document instances is not currently supported")};var i=function(){e.documentDefinitions&&(e.state.definitions=Object.keys(e.documentDefinitions).map(function(t){return e.documentDefinitions[t]}))};i();var s=t.subscribe(n.loadTabs,e,function(t){t?e.state.definitions=Object.keys(t).map(function(e){return t[e]}):e.state.definitions=null});e.$on("$destroy",function(){t.unsubscribe(s)})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Events,i=e.Const.API;angular.module("calypso.directives").directive("formToolbar",["$parse","$http","$state","$stateParams","EventBus","DB","DocumentService","DocumentFilter","CSV","Loading",function(t,s,o,a,c,r,l,u,d,p){return{scope:{document:"=",documentDefinitions:"=",documentData:"=",filterDefinition:"="},templateUrl:e.Const.Templates.IUCLID_FORM_TOOLBAR_TPL,link:function(s){s.state={downloadTxtUrl:e.Const.API.BASE_URL+"/txt/"+s.document.identifier,downloadCsvUrl:i.BASE_URL+"/csv/"+s.document.identifier},s.cancel=function(){var e=r.getEntityContext();o.go(e.state)},s.save=function(){var e=r.getEntityContext(),i=s.documentData?angular.copy(s.documentData[1]):{},a=l.generateJsonDocumentEnvelope(s.document,i);p.show(),l.save(a).then(function(t){if("SUBSTANCE"!==e.docType)o.go(e.state);else if(e.docType===e.sectionCode)t.isCreate?(e.sectionUuid=t.header.key,r.setEntityContext(e),o.go("edit-entity",{entityType:e.docType,entityKey:t.header.key,snapshot:0})):o.go(e.state);else{var i=r.getCompletedSections();if(e.sectionCode&&(i[e.sectionCode]=t.header),t.isCreate){var a=s.documentDefinitions||{};e.sectionUuid=t.header.key,r.setEntityContext(e),a[t.header.name||t.header.definition]=t.header,c.publish(n.loadTabs,a),c.publish(n.loadDocumentData,t.body)}c.publish(n.setCompletedSections)}}).catch(function(e){var n,i=(t("data.info.errors")(e)||[{}])[0];n=i.code||i.message?i.code+": "+i.message+"\nPath: "+i.path:t("data.message")(e),alert(n)}).finally(function(){p.hide()})},s.delete=function(){var e=r.getEntityContext();window.confirm("Are you sure you want to delete this "+e.sectionCode+"?")&&(p.show(),l.delete(e.docType,a.entityKey,e.sectionCode,e.sectionUuid).then(function(){var t=r.getCompletedSections();e.sectionCode&&(t[e.sectionCode]=null),e.sectionUuid=null,r.setEntityContext(e),r.setCompletedSections(t),c.publish(n.setCompletedSections),c.publish(n.loadDocumentDefinition,e.docType)}).catch(function(){alert("Error deleting document")}).finally(function(){p.hide()}))},s.filter=function(){u.toggle()},s.collapseAll=function(){c.publish(n.collapseAllSections)},s.downloadCsv=function(){d.download(s.document)}}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidForm",[function(){return{scope:{document:"=",documentDefinitions:"=",documentData:"=",filterDefinition:"="},templateUrl:e.Const.Templates.IUCLID_FORM_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("iuclidFormContent",[function(){return{scope:{contents:"="},templateUrl:e.Const.Templates.IUCLID_FORM_CONTENTS_TPL}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Events;angular.module("calypso.directives").directive("iuclidFormPicker",["$rootScope","$timeout","$stateParams","EventBus","DB","DocumentService","DocumentFilter","Loading",function(t,i,s,o,a,c,r,l){return{scope:{documentDefinitions:"="},templateUrl:e.Const.Templates.IUCLID_FORM_PICKER_TPL,link:function(e,t){e.state={documentDefinition:null,documentDefinitions:[],documentData:null,submissionType:a.getSubmissionType(),filterDefinition:r.isApplied()},e.loadSubmissionType=function(){o.publish(n.loadSubmissionType,e.state.submissionType)},e.state.submissionType&&e.loadSubmissionType();var i=function(i,s){o.publish(n.loadTabs,e.state.documentDefinitions);var a=t[0].querySelector(".iuclid-form-content-wrapper");a&&(a.scrollTop=0),e.state.filterDefinition&&c.filter(s),e.state.documentData&&c.apply(s,e.state.documentData),e.state.documentDefinition=s,l.hide()},u=o.subscribe(n.loadSubmissionType,e,function(t){e.state.documentDefinition=null,e.state.submissionType=t}),d=o.subscribe(n.loadDocumentData,e,function(t){e.state.documentData=t}),p=function(e,t){var n=(t.representation||{})[0];if(n)return e=e||{},e[n.name||n.definition]=n,e},f=o.subscribe(n.loadDocumentDefinition,e,function(t){var n=a.getEntityContext();l.show(),c.getDocumentDefinition(t).then(function(o){n.sectionCode=t,a.setEntityContext(n),s.entityKey?c.getDocumentData(n.docType,s.entityKey,t).then(function(t){e.state.documentDefinitions=t.reduce(p,null);var i=t[0];i&&i.representation&&i.representation[1]?(e.state.documentData=i.representation[1],n.sectionUuid=i.representation[0].key.split("/")[0]):(e.state.documentData=null,delete n.sectionUuid),a.setEntityContext(n)}).catch(function(t){console.error("Failed to get document data: "+JSON.stringify(t)),e.state.documentData=null,e.state.documentDefinitions=null}).finally(function(){i(t,o)}):(e.state.documentData=null,e.state.documentDefinitions=null,i(t,o))}).catch(function(e){alert("Failed to Get Document Definition: "+JSON.stringify(e)),l.hide()})}),m=o.subscribe(n.filterDocumentDefinition,e,function(t){var i=a.getEntityContext();e.state.filterDefinition=!!t,o.publish(n.loadDocumentDefinition,i.sectionCode||i.docType)});e.$on("$destroy",function(){o.unsubscribe(m),o.unsubscribe(f),o.unsubscribe(u),o.unsubscribe(d)})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){angular.module("calypso.directives").directive("ngxDropDown",[function(){return{restrict:"E",replace:!0,templateUrl:e.Const.Templates.NGX_DROP_DOWN_TPL,scope:{placeholder:"@",values:"=",onChange:"&"},link:function(e,t){e.data={disabled:!1,value:null},e.data.value=e.placeholder||"Select...",e.select=function(t){e.data.value=t.title,angular.isFunction(e.onChange)&&e.onChange({value:t})},t.bind("click",function(n){n.stopPropagation(),e.data.disabled||t.toggleClass("active")})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(e){angular.module("calypso.directives").directive("ngxMultiple",[function(){return{restrict:"A",link:function(e,t,n){"true"!==n.ngxMultiple&&n.ngxMultiple!==!0||t.attr("multiple",!0)}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Events,i=e.Const.Templates;angular.module("calypso.directives").directive("sideTree",["$rootScope","$timeout","$interval","_","FuzzySearch","DB","EventBus","TreeService","Loading",function(e,t,s,o,a,c,r,l,u){return{restrict:"E",scope:{},templateUrl:i.SIDE_TREE_TPL,link:function(i,d){var p=1,f=c.getSubmissionTypes();i.state={submissionTypes:f,submissionType:f[p],filter:"",tree:null,treeDisplay:null,treeOpen:!1},i.props={selectedCode:null};var m=function(){var e=i.state.filter.toLowerCase();i.state.filter?(i.state.treeDisplay=angular.copy(i.state.tree),Object.keys(i.state.treeDisplay.sections).forEach(function(t){var n=i.state.treeDisplay.sections[t];n&&n.documents.length>0&&(n.documents=new a(n.documents,["title"]).search(e))})):i.state.treeDisplay=i.state.tree},v=function(e){i.state.submissionType?l.getTreeDefinition(i.state.submissionType.identifier,e).then(function(e){i.state.tree=e,m()}).catch(function(e){alert("Failed to Load Tree: "+JSON.stringify(e))}).finally(function(){u.hide()}):u.hide()},y=function(){i.state.treeOpen=!i.state.treeOpen,i.state.treeOpen?e.overlay=!0:t(function(){e.overlay=!1},200)},h=function(){i.state.treeOpen=!1,e.overlay=!1},g=function(){u.show(),v(!0)},_=r.subscribe(n.setCompletedSections,i,g),T=r.subscribe(n.toggleSideBar,i,y),b=r.subscribe(n.hideSideBar,i,h),E=r.subscribe(n.loadDocumentDefinition,i,function(e){i.props.selectedCode=e});if(i.$on("$destroy",function(){r.unsubscribe(T),r.unsubscribe(b),r.unsubscribe(E),r.unsubscribe(_)}),i.filter=o.debounce(function(){i.$apply(m)},100),i.loadSubmissionType=function(){u.show(),i.props.selectedCode=null,v(!1)},i.state.submissionType)i.loadSubmissionType();else var D=s(function(){var e=c.getSubmissionTypes();e&&(i.state.submissionTypes=e,i.state.submissionType=e[p],s.cancel(D),i.loadSubmissionType())},100)}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={}));var calypso;!function(e){var t;!function(t){var n=e.Const.Events,i=e.Const.Templates;angular.module("calypso.directives").directive("sideTreeSection",["EventBus",function(e){return{restrict:"E",scope:{section:"=",props:"="},templateUrl:i.SIDE_TREE_SECTION_TPL,link:function(t){t.state={collapsed:!0},t.loadNodeDocument=function(t){e.publish(n.hideSideBar),e.publish(n.loadDocumentDefinition,t.code)},t.toggleSection=function(){t.state.collapsed?(e.publish(n.collapseAllSideBarSections),t.state.collapsed=!1):t.state.collapsed=!0};var i=e.subscribe(n.setCompletedSections,t,function(){t.state.collapsed="Completed"!==t.section.title}),s=e.subscribe(n.collapseAllSideBarSections,t,function(){t.state.collapsed=!0});t.$on("$destroy",function(){e.unsubscribe(i),e.unsubscribe(s)})}}}])}(t=e.Directives||(e.Directives={}))}(calypso||(calypso={})),angular.module("calypso").run(["$templateCache",function(e){e.put("/templates/edit-entity.html",'<side-tree ng-if="state.context.sections"></side-tree>\n<div class="main-view"\n     ng-class="{ \'main-view--no-side\': state.context.sections === false }">\n    <iuclid-form-picker document-definitions="state.documentDefinitions"></iuclid-form-picker>\n</div>\n'),e.put("/templates/entities.html",'<div class="side-tree"\n     ng-class="{ \'tree-open\': state.treeOpen }">\n    <ul class="side-tree__node-container side-tree__entities-node-container">\n        <li class="side-tree__block-node">\n            <a href="/#/entities/{{ state.new_link }}/new" class="btn btn-primary">Create New</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.substances" ui-sref-active="active">SUBSTANCES</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.reference-substances" ui-sref-active="active">REFERENCE SUBSTANCES</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.mixtures" ui-sref-active="active">MIXTURES</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.templates" ui-sref-active="active">TEMPLATES</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.categories" ui-sref-active="active">CATEGORIES</a>\n        </li>\n        <li class="side-tree__separator"></li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.literature" ui-sref-active="active">LITERATURE</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.legal-entities" ui-sref-active="active">LEGAL ENTITIES</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.contacts" ui-sref-active="active">CONTACTS</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.sites" ui-sref-active="active">SITES</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.annotations" ui-sref-active="active">ANNOTATIONS</a>\n        </li>\n        <li class="side-tree__anchor-node">\n            <a ui-sref="entities.dossier" ui-sref-active="active">DOSSIER</a>\n        </li>\n    </ul>\n</div>\n<div class="main-view">\n    <ui-view></ui-view>\n</div>\n'),e.put("/templates/new-entity.html",'<div class="new-entity__container">\n    <iuclid-form-picker></iuclid-form-picker>\n</div>'),e.put("/templates/not-found.html",'<div style="text-align: center; padding: 100px;">\n    <h1>We couldn\'t find the page you\'re looking for</h1>\n    <h3>\n        <a href="#/">Return Home</a>\n    </h3>\n</div>\n'),e.put("/templates/directives/entity-list.html",'<div class="entity-list">\n    <div class="entity-list-container">\n        <div class="list-header" style="display: flex; padding: 20px; border-bottom: 1px solid #e7e7e7;">\n            <span class="entity-header__name">Name</span>\n            <span class="entity-header__created-on">Created On</span>\n            <span class="entity-header__modified-on sort sort-desc">Modified On <i class="fa fa-caret-down"></i></span>\n            <span class="entity-header__actions">\n                <i class="fa fa-repeat entity-item__action" ng-click="refresh()"></i>\n            </span>\n        </div>\n        <ul class="entity-item__container">\n            <li ng-repeat="entity in entities" class="entity-item">\n                <a href="/#/entities{{ entityUrl }}/{{ entity.representation.key }}"\n                   class="entity-item__name">{{ entity.representation.publicName || entity.representation.name }}</a>\n                <span class="entity-item__created-on">{{ entity.representation.createdOn | date:\'medium\' }}</span>\n                <span class="entity-item__modified-on">{{ entity.representation.modifiedOn | date:\'medium\' }}</span>\n                <div class="entity-item__actions">\n                    <i class="fa fa-trash entity-item__action" ng-click="deleteEntity(entity, $index)"></i>\n                </div>\n            </li>\n        </ul>\n\n        <div ng-if="entities.length === 0" class="entity-list__empty-state">\n            <h1><i class="fa fa-cloud"></i></h1>\n            <h2>No {{ entityDisplayName }} could be found!</h2>\n        </div>\n    </div>\n</div>\n'),e.put("/templates/directives/search-bar.html",'<div class="search-bar">\n    <a class="on-mobile side-bar-toggle"\n       ng-click="toggleSidebar()"\n       ng-if="state.showHamburger">\n        <i class="fa fa-bars"></i>\n    </a>\n    <a ui-sref="entities"\n       ui-sref-active="active"\n       ng-click="goHome($event)">\n        HOME\n    </a>\n    <span class="search-bar__title">\n        {{ state.title }}\n    </span>\n</div>\n'),e.put("/templates/directives/side-filter.html",'<div class="side-filter">\n    <div ng-repeat="filter in filters" class="filter-category">\n        <iuclid-substance-filter filter="filter"></iuclid-substance-filter>\n    </div>\n</div>\n'),e.put("/templates/directives/ngx/drop-down.html",'<div class="drop-down__wrapper">\n    <div class="drop-down__label__wrapper">\n        <span class="drop-down__label">{{ data.value }}</span>\n        <i class="fa fa-angle-down"></i>\n    </div>\n    <ul class="drop-down__item-wrapper">\n        <li class="drop-down__item"\n            ng-repeat="item in values"\n            ng-click="select(item)">\n            {{ item.title }}\n        </li>\n    </ul>\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-attachment.html",'<div class="form__content form__content--attachment">\n    <label>{{ content.title }}</label>\n    <input type="file"\n           name="{{ content.name }}"\n           accept="{{ content.mimeType }}"\n           ngx-multiple="{{ !!content.name }}" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-block.html",'<div class="form__content form__content--block"\n        ng-class="{ \'form__content--block--expanded\': state.expanded }">\n    <h3 class="form__conent--block__title"\n            ng-click="toggleWrapper()">\n        <i class="fa collapse-toggle"\n           ng-class="{ \'fa-chevron-down\': state.expanded, \'fa-chevron-right\': !state.expanded }">\n        </i>\n        {{ content.title }}\n        <i class="fa fa-check-circle"\n            ng-class="content.invalid === true ? \'fa-exclamation-circle\' : \'fa-check-circle\'">\n        </i>\n    </h3>\n    <div class="form__content--block__wrapper">\n        <iuclid-form-content contents="content.contents"></iuclid-form-content>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-checkbox.html",'<div class="form__content form__content--checkbox">\n    <label>\n        <input type="checkbox" ng-model="content.value" />\n        {{ content.title }}\n    </label>\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-date.html",'<div class="form__content form__content--date">\n    <label>{{ content.title }}</label>\n    <input type="date"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-numeric.html",'<div class="form__content form__content--numeric">\n    <label>{{ content.title }}</label>\n    <input type="number"\n           ng-model="content.value"\n           min="{{ content.min }}"\n           max="{{ content.max }}" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-pick-list.html",'<div class="form__content form__content--pick-list">\n    <label>{{ content.title }}</label>\n\n    <select ng-options="item.phrase.code as item.phrase.text for item in state.phraseGroup"\n            ngx-multiple="{{ content.multiple }}"\n            ng-model="content.value"\n            class="form__content--pick-list__select">\n    </select>\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-range.html",'<div class="form__content form__content--range">\n    <label>{{ content.title }}</label>\n    <input type="range"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-attributes/iuclid-text.html",'<div class="form__content form__content--text">\n    <label>{{ content.title }}</label>\n    <!--\n        If the content\'s max length is greater than 256\n        then we should use a text input to provide the\n        ability to provide a larger body of text.\n        Maybe in the future we want to provide some rich\n        text editor?\n    -->\n    <textarea ng-if="content.maxLength && content.maxLength > 256"\n              ng-model="content.value"\n              maxlength="{{ content.maxLength }}">\n    </textarea>\n    <!--\n        Otherwise for type text where the max length is less\n        then 256 we should use a regular text input since\n        it\'s more likely this is a relatively shorter value\n    -->\n    <input ng-if="!content.maxLength || content.maxLength <= 256"\n           type="text"\n           maxlength="{{ content.maxLength }}"\n           ng-model="content.value" />\n</div>\n'),e.put("/templates/directives/iuclid-form/form-tabs.html",'<div class="form-tab__container"\n     ng-if="state.definitions">\n    <div class="form-tab active"\n         ng-repeat="documentDefinition in state.definitions">\n        <span class="form-tab__label">\n            {{ documentDefinition.name || documentDefinition.definition }}\n        </span>\n    </div>\n    <div class="form-tab form-tab--add" ng-click="addTab()">\n        <span class="form-tab__label form-tab__label--add">\n            <i class="fa fa-plus"></i>\n        </span>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-form/form-toolbar.html",'<div class="form-toolbar">\n    <!-- FILTER -->\n    <button class="btn"\n            ng-class="{ \'pressed\': filterDefinition }"\n            ng-click="filter()"\n            title="Toggle custom filters">\n        <i class="fa fa-filter"></i>\n    </button>\n\n    <!-- COLLAPSE ALL SECTIONS -->\n    <button class="btn"\n            ng-click="collapseAll()"\n            title="Collapse all sections">\n        <i class="fa fa-indent"></i>\n    </button>\n\n    <div class="form-toolbar--filler"></div>\n\n    <!-- SAVE DOCUMENT -->\n    <button class="btn"\n            ng-click="save()"\n            ng-if="document"\n            title="Save document">\n        <i class="fa fa-save"></i>\n    </button>\n\n    <!-- DOWNLOAD CSV -->\n    <a href="{{ state.downloadCsvUrl }}"\n       class="btn"\n       title="Download csv extract"\n       ng-if="documentData">\n        <i class="fa fa-file-excel-o"></i>\n    </a>\n\n    <!-- DOWNLOAD TXT -->\n    <a href="{{ state.downloadTxtUrl }}"\n       class="btn"\n       title="Download text extract"\n       ng-if="document">\n        <i class="fa fa-file-text-o"></i>\n    </a>\n\n    <span class="form-toolbar__separator" ng-if="documentData"></span>\n\n    <!-- DELETE -->\n    <button class="btn"\n            ng-click="delete()"\n            title="Delete"\n            ng-if="documentData">\n        <i class="fa fa-trash"></i>\n    </button>\n</div>\n'),e.put("/templates/directives/iuclid-form/iuclid-form-contents.html",'<div ng-repeat="content in contents" ng-switch="content.type">\n    <iuclid-block ng-switch-when="block" content="content"></iuclid-block>\n    <iuclid-text ng-switch-when="text" content="content"></iuclid-text>\n    <iuclid-checkbox ng-switch-when="boolean" content="content"></iuclid-checkbox>\n    <iuclid-range ng-switch-when="range" content="content"></iuclid-range>\n    <iuclid-numeric ng-switch-when="numeric" content="content"></iuclid-numeric>\n    <iuclid-pick-list ng-switch-when="picklist" content="content"></iuclid-pick-list>\n    <iuclid-attachment ng-switch-when="attachment" content="content"></iuclid-attachment>\n    <iuclid-date ng-switch-when="date" content="content"></iuclid-date>\n\n    <div ng-switch-default class="form__content">\n        <p class="no-type-warn">\n            <b>No Form Attribute Implementation for Type:</b>[ {{ content.type }} ]<br>\n            <b>Content:</b> {{ content }}\n        </p>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-form/iuclid-form-picker.html",'<div class="form-picker__wrapper">\n    <h2 class="form-picker__title" ng-if="state.documentDefinition">\n        {{ state.documentDefinition.identifier }}\n        <small>{{ state.documentDefinition.provider }} {{ state.documentDefinition.version }}</small>\n    </h2>\n\n    <div ng-if="!state.documentDefinition" class="empty-state">\n        <h2 class="empty-state__title">Choose a Document</h2>\n        <i class="fa fa-arrow-circle-left empty-state__icon"></i>\n        <p class="empty-state__description">Select a document from the Tree on the left. Note that there are required vs. optional Documents</p>\n    </div>\n\n    <div ng-if="state.documentDefinition">\n        <iuclid-form document="state.documentDefinition"\n                     document-definitions="state.documentDefinitions"\n                     document-data="state.documentData"\n                     filter-definition="state.filterDefinition">\n        </iuclid-form>\n    </div>\n</div>\n'),e.put("/templates/directives/iuclid-form/iuclid-form.html",'<div class="iuclid-form">\n    <form-tabs document-definitions="documentDefinitions"></form-tabs>\n    <form-toolbar document="document"\n                  document-definitions="documentDefinitions"\n                  document-data="documentData"\n                  filter-definition="filterDefinition">\n    </form-toolbar>\n    <div class="iuclid-form-content-wrapper">\n        <iuclid-form-content contents="document.contents"></iuclid-form-content>\n    </div>\n</div>\n'),e.put("/templates/directives/side-tree/side-tree-section.html",'<h3 class="side-tree__section__title"\n        ng-click="toggleSection($event)">\n    <i class="fa collapse-toggle"\n        ng-class="{ \'fa-chevron-down\': !state.collapsed, \'fa-chevron-right\': state.collapsed }"> </i>\n    {{ section.title }}\n    <span class="badge">{{ section.documents.length }}</span>\n</h3>\n<ul class="side-tree__node-container"\n        ng-class="{ \'side-tree__node-container--collapsed\': state.collapsed }">\n    <li class="side-tree__node"\n        ng-class="{ \'active\': (props.selectedCode === document.code) }"\n        ng-click="loadNodeDocument(document)"\n        ng-repeat="document in section.documents">\n        {{ document.title }}\n    </li>\n    <li class="empty-state__side-tree-section" ng-if="section.documents.length === 0">\n        <i class="fa fa-folder-open-o"></i>\n        <br/>\n        <span>Nothing here!</span>\n    </li>\n</ul>'),e.put("/templates/directives/side-tree/side-tree.html",'<div class="side-tree"\n     ng-class="{ \'tree-open\': state.treeOpen }">\n    <select class="submission-type__select"\n            ng-model="state.submissionType"\n            ng-change="loadSubmissionType()"\n            ng-options="type as type.title for type in state.submissionTypes">\n    </select>\n    <div ng-if="state.tree">\n        <div class="side-tree__filter-container">\n            <input type="text"\n                   class="side-tree__filter"\n                   placeholder="Filter..."\n                   ng-model="state.filter"\n                   ng-change="filter()">\n        </div>\n        <side-tree-section section="state.treeDisplay.sections.completed" props="props"></side-tree-section>\n        <side-tree-section section="state.treeDisplay.sections.required" props="props"></side-tree-section>\n        <side-tree-section section="state.treeDisplay.sections.endpointStudies" props="props"></side-tree-section>\n        <side-tree-section section="state.treeDisplay.sections.endpointSummaries" props="props"></side-tree-section>\n        <side-tree-section section="state.treeDisplay.sections.others" props="props"></side-tree-section>\n    </div>\n</div>\n')}]);